# -*- coding: utf-8 -*- This line is just for your information, the python plugin will not use the first line;;
SPATIALITE create view CHANGETOVIEWNAME as select tab1.rowid as rowid, tab1.obsid as obsid, cast(tab2.h_gs - tab1.depthtop as real) as z_coord, cast(tab1.depthtop - tab1.depthbot as real) as height, geometry from stratigraphy as tab1, (select obsid, geometry, (case when ((h_gs is null or not(h_gs >0)) and h_toc > 0 and h_tocags > 0) then h_toc - h_tocags else (case when ((h_gs is null or not(h_gs >0)) and (h_tocags is null or h_tocags=0) and h_toc > 0) then h_toc - 1 else h_gs end) end) as h_gs from obs_points where (typeof(h_toc) in ('integer', 'real') or typeof(h_gs) in ('integer', 'real'))) as tab2 WHERE tab1.obsid = tab2.obsid and typeof("tab2"."h_gs") = 'real' and lower(tab1.geoshort) CHANGETOPLOTTYPESDICTVALUE;
SPATIALITE insert into views_geometry_columns (view_name, view_geometry, view_rowid, f_table_name, f_geometry_column, read_only) values ('CHANGETOVIEWNAME', 'geometry', 'rowid', 'obs_points', 'geometry',1);
POSTGIS create view CHANGETOVIEWNAME as select tab1.ctid as rowid, tab1.obsid, tab2.h_gs - tab1.depthtop AS z_coord, tab1.depthtop - tab1.depthbot as height, geometry FROM stratigraphy tab1 JOIN (select obsid, geometry, (CASE WHEN COALESCE(h_gs, 0) > 0 THEN h_gs WHEN COALESCE(h_toc, 0) > 0 THEN h_toc - (CASE WHEN COALESCE(h_tocags, 0) = 0 THEN 1 ELSE h_tocags END) ELSE NULL::DOUBLE PRECISION END) AS h_gs FROM obs_points) tab2 ON tab2.obsid = tab1.obsid AND tab2.h_gs IS NOT NULL WHERE LOWER(tab1.geoshort) CHANGETOPLOTTYPESDICTVALUE;


